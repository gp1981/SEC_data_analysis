# Explore data retrieved from SEC

In this section, we will explore the structure of the SEC data retrieved from the API. The data is organized in a structured format compliant with SEC reporting standards. Understanding this structure is crucial for effective analysis.

First, we load the various libraries.

```{r load_libraries, eval=FALSE, echo = FALSE, warning=FALSE}
# Include the shared setup file
source("setup.qmd")
```

Next, let's retrieve the objects that we need for the data exploration:

```{r load_object1, eval=TRUE}
# Load company_Data
company_Data <- readRDS("company_data.RDS")
cik <- readRDS("cik.RDS")
```

## Structure of the SEC data: XBRL

The structure the data retrieved from SEC API is a structured financial data in compliance with SEC reporting standards.The SEC data is organized in XBRL (eXtensible Business Reporting Language), which is a structured, machine-readable format. It ensures consistency and comparability of financial data across different companies and filings.

In practice, if you want to analyze specific financial metrics like "Assets," you would navigate through the structure to access the corresponding "fact" under the relevant "concept." This allows you to extract and work with financial data for analysis or reporting. The structure includes:

-   **`cik`**: This is the Central Index Key (CIK) of the company. It's a unique identifier assigned to each company that files reports with the U.S. Securities and Exchange Commission (SEC).

-   **`entityName`**: This is the name of the company, in this case, "Apple Inc."

-   **`facts`**: This is the main container for financial data. Within "facts," you have two main sections:

    -   **`dei`**: This section contains financial data related to Document and Entity Information (DEI). DEI data includes basic company information, such as the entity's common stock shares outstanding and the entity's public float.

    -   **`us-gaap`**: This section contains financial data that follows the U.S. Generally Accepted Accounting Principles (GAAP). It includes a wide range of financial concepts, which are organized as a list of financial items.

Within these sections, you'll find the actual financial data represented as a list of items. Each item has specific attributes that describe the financial information:

-   **Concept**: A "concept" represents a specific financial measure or item. For example, "Assets" or "AccountsPayable" are concepts. Each concept has an associated label and a data type.

-   **Facts**: Under each concept, you have "facts." These are the actual numerical values or data associated with the concept. For example, "Assets" will have a fact that represents the total assets value for the company. Facts typically have attributes like "value," "unitRef," and "contextRef."

-   **Attributes**: Facts may have additional attributes that provide context for the data, such as the reporting period, currency unit, or the precision of the data.

To analyze and work with this data effectively, you would typically need to select specific concepts and facts that are relevant to your analysis, and you may also need to transform or pivot the data into a more tabular format for further processing and visualization.

We split the data in `company_Data` into separate Lists: `company_Metadata`, `company_Facts`, `company_Concept`

```{r split_company_Data, eval=TRUE}
# Split the lists in company_Data
company_Metadata <- company_Data$company_Metadata
company_Facts <- company_Data$company_Facts
company_Concept <- company_Data$company_Concept
```

### Uderstanding 'company_Data'

You can see the structure in textual format:

```{r str_company_Data, eval=TRUE, message=FALSE}
# Visualize structure of the company_Metadata with a collapsible section
library(magrittr)
str(company_Metadata) %>% print()
```

As you can see the structure of company_Data is large and complex.

### Creating dataframe
Let's create now a first dataframe:

```{r Explore Data, message=FALSE, warning=FALSE}
# Create a DataFrame with relevant data
company_df <- data.frame(
  CIK = cik,
  Name = company_Metadata$name,
  FiscalYearEnd = company_Metadata$fiscalYearEnd,
  AssetsLabel = company_Facts$facts$`us-gaap`$Assets$label,
  AssetsDescription = company_Facts$facts$`us-gaap`$Assets$description
  # Add more relevant columns here
)
library(knitr)
kable(company_df)
```

Let's say that we want to recreate a summary version of the balance sheet of Apple Inc. based on the last filing. The dataframe would be generated in the following way: 

```{r balancesheet, warning=FALSE, message=FALSE}
# Load necessary libraries
library(dplyr)

# Extract detailed information for the Balance Sheet summary
detailed_balance_sheet_summary <- data.frame(
  CIK = cik,
  Name = company_Metadata$name,
  FiscalYearEnd = company_Metadata$fiscalYearEnd,
  CashAndCashEquivalents = company_Facts$facts$`us-gaap`$CashAndCashEquivalentsAtCarryingValue$units$USD$val
)

# Add a FiscalYear column
detailed_balance_sheet_summary <- detailed_balance_sheet_summary %>%
  mutate(FiscalYear = as.character(FiscalYearEnd))

# Format the CashAndCashEquivalents column
detailed_balance_sheet_summary$CashAndCashEquivalents_Millions <- format(
  detailed_balance_sheet_summary$CashAndCashEquivalents / 1e6,
  big.mark = ",",
  scientific = FALSE
)


# Add a column for unit of measure
detailed_balance_sheet_summary$CashAndCashEquivalents_Unit <- paste0(
  detailed_balance_sheet_summary$CashAndCashEquivalents_Million, " USD (millions)"
)

  # AccountsReceivable = company_Facts$facts$`us-gaap`$AccountsReceivableNet$value,
  # Inventory = company_Facts$facts$`us-gaap`$InventoryNet$value,
  # TotalCurrentAssets = company_Facts$facts$`us-gaap`$AssetsCurrent$value,
  # PropertyPlantAndEquipment = company_Facts$facts$`us-gaap`$PropertyPlantAndEquipmentNet$value,
  # TotalAssets = company_Facts$facts$`us-gaap`$Assets$value,
  # AccountsPayable = company_Facts$facts$`us-gaap`$AccountsPayableCurrent$value,
  # TotalShortTermDebtsAndLeasing = company_Facts$facts$`us-gaap`$DebtCurrent$value,
  # TotalCurrentLiabilities = company_Facts$facts$`us-gaap`$LiabilitiesCurrent$value,
  # TotalLongTermDebtsAndLeasing = company_Facts$facts$`us-gaap`$DebtNoncurrent$value,
  # TotalLiabilities = company_Facts$facts$`us-gaap`$Liabilities$value,
  # CommonStock = company_Facts$facts$`us-gaap`$CommonStockSharesOutstanding$value,
  # PreferredStock = company_Facts$facts$`us-gaap`$PreferredStockValue$value,
  # RetainedEarnings = company_Facts$facts$`us-gaap`$RetainedEarningsAccumulatedDeficit$value,
  # AdditionalPaidInCapital = company_Facts$facts$`us-gaap`$AdditionalPaidInCapital$value,
  # TreasuryStock = company_Facts$facts$`us-gaap`$TreasuryStockValue$value,
  # TotalStockholdersEquity = company_Facts$facts$`us-gaap`$StockholdersEquity$value,
  # MinorityInterest = company_Facts$facts$`us-gaap`$MinorityInterest$value
# )
# 
# Display the formatted summary dataframe
kable(detailed_balance_sheet_summary[, c("CIK", "Name", "FiscalYear", "CashAndCashEquivalents_Unit")])


```
